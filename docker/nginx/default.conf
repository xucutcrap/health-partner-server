upstream health_partner_app {
    server app:3000;
}

server {
    listen 80;
    server_name _; 

    # 1. 静态页面与资源 (映射到容器内的 /app/static)
    # -------------------------------------------------
    location = /pay.html {
        alias /app/static/pay.html;
    }

    location /images/ {
        alias /app/static/images/;
    }
    
    location /posters/ {
        alias /app/static/posters/;
    }
    
    location /output/upload/ {
        alias /app/static/output/upload/;
    }

    # 2. 接口代理 (全部统一到 Node.js 3000端口)
    # 核心 API (Node.js 已包含 api/v1 路由)
    location /api/v1/ {
        proxy_pass http://health_partner_app/api/v1/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 长连接超时设置 (适配AI识别等长任务)
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }
}
